# 鹦学伴 - 管理后台接口文档

## 一、概述

管理后台接口用于PC端管理系统，提供视频管理、用户管理、分类管理、数据统计等功能。

**接口前缀**: `/admin`  
**认证方式**: Bearer Token (Sa-Token)

---

## 二、管理员认证

### 2.1 管理员登录

**接口**: `POST /admin/auth/login`

**请求参数**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "adminInfo": {
      "id": 1,
      "username": "admin",
      "realName": "超级管理员",
      "role": 1,
      "lastLoginTime": "2025-12-23T14:00:00"
    }
  }
}
```

### 2.2 获取当前管理员信息

**接口**: `GET /admin/auth/info`

**Headers**: `Authorization: Bearer {token}`

**响应**:
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "admin",
    "realName": "超级管理员",
    "phone": "13800138000",
    "email": "admin@yxb.com",
    "avatar": "https://xxx.com/avatar.png",
    "role": 1,
    "status": 1,
    "lastLoginTime": "2025-12-23T14:00:00"
  }
}
```

### 2.3 退出登录

**接口**: `POST /admin/auth/logout`

---

## 三、视频管理

### 3.1 分页查询视频

**接口**: `GET /admin/video/page`

**参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 否 | 页码，默认1 |
| pageSize | int | 否 | 每页数量，默认10 |
| title | string | 否 | 标题模糊搜索 |
| language | string | 否 | 语种代码 |
| level | int | 否 | 难度等级 1-4 |
| categoryId | long | 否 | 分类ID |
| status | int | 否 | 状态 0-下架 1-上架 |
| source | int | 否 | 来源 1-上传 2-YouTube |

**响应**:
```json
{
  "code": 200,
  "data": {
    "records": [
      {
        "id": 1,
        "title": "TED演讲：如何学习语言",
        "coverUrl": "https://xxx.com/cover.jpg",
        "videoUrl": "https://xxx.com/video.mp4",
        "duration": 600,
        "language": "en",
        "level": 2,
        "categoryId": 4,
        "playCount": 1000,
        "status": 1,
        "createTime": "2025-12-22T10:00:00"
      }
    ],
    "total": 100,
    "pages": 10
  }
}
```

### 3.2 获取视频详情

**接口**: `GET /admin/video/{id}`

### 3.3 创建视频

**接口**: `POST /admin/video`

**请求参数**:
```json
{
  "title": "视频标题",
  "description": "视频描述",
  "coverUrl": "https://xxx.com/cover.jpg",
  "videoUrl": "https://xxx.com/video.mp4",
  "duration": 600,
  "language": "en",
  "level": 2,
  "categoryId": 4,
  "tags": "TED,演讲,英语"
}
```

### 3.4 更新视频

**接口**: `PUT /admin/video`

**请求参数**:
```json
{
  "id": 1,
  "title": "更新后的标题",
  "description": "更新后的描述"
}
```

### 3.5 删除视频

**接口**: `DELETE /admin/video/{id}`

### 3.6 更新视频状态

**接口**: `PUT /admin/video/{id}/status?status=0`

---

## 四、分类管理

### 4.1 获取分类树

**接口**: `GET /admin/category/tree`

**响应**:
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "The Daily Show",
      "icon": null,
      "parentId": 0,
      "sort": 1,
      "status": 1,
      "children": []
    },
    {
      "id": 2,
      "name": "每日快讯",
      "icon": null,
      "parentId": 0,
      "sort": 2,
      "status": 1,
      "children": []
    }
  ]
}
```

### 4.2 获取所有分类

**接口**: `GET /admin/category/list`

### 4.3 创建分类

**接口**: `POST /admin/category`

**请求参数**:
```json
{
  "name": "电影片段",
  "icon": "https://xxx.com/icon.png",
  "parentId": 0,
  "sort": 3,
  "status": 1
}
```

### 4.4 更新分类

**接口**: `PUT /admin/category`

### 4.5 删除分类

**接口**: `DELETE /admin/category/{id}`

---

## 五、用户管理

### 5.1 分页查询用户

**接口**: `GET /admin/user/page`

**参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 否 | 页码 |
| pageSize | int | 否 | 每页数量 |
| phone | string | 否 | 手机号模糊搜索 |
| nickname | string | 否 | 昵称模糊搜索 |
| status | int | 否 | 状态 0-禁用 1-正常 |
| vipLevel | int | 否 | VIP等级 |

### 5.2 获取用户详情

**接口**: `GET /admin/user/{id}`

### 5.3 更新用户状态

**接口**: `PUT /admin/user/{id}/status?status=0`

### 5.4 设置VIP

**接口**: `PUT /admin/user/{id}/vip?vipLevel=1&days=30`

---

## 六、数据统计

### 6.1 获取统计概览

**接口**: `GET /admin/stats/overview`

**响应**:
```json
{
  "code": 200,
  "data": {
    "totalUsers": 10000,
    "todayNewUsers": 50,
    "vipUsers": 500,
    "totalVideos": 200,
    "totalPlayCount": 50000,
    "todayPlayCount": 1000,
    "activeUsers": 3000
  }
}
```

---

## 七、错误码

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 参数错误 |
| 401 | 未登录 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## 八、数据库表结构

详见 `doc/sql/` 目录下的SQL文件：

- `admin_info.sql` - 管理员表
- `user_info.sql` - 用户表
- `video_info.sql` - 视频表
- `video_category.sql` - 视频分类表
- `video_subtitle.sql` - 字幕表
